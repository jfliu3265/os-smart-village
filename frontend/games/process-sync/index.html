<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‘æ°‘åä½œ - è¿›ç¨‹åŒæ­¥å­¦ä¹ </title>
    <link rel="stylesheet" href="../../styles/main.css">
    <style>
        .game-container {
            display: flex;
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .game-area {
            flex: 1;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .side-panel {
            width: 380px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .panel-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .panel-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .sync-mechanism-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: 2px solid #9b59b6;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .sync-mechanism-btn:hover {
            background: #9b59b6;
            color: white;
            transform: translateX(5px);
        }

        .sync-mechanism-btn.active {
            background: #9b59b6;
            color: white;
        }

        .village-scene {
            background: linear-gradient(to bottom, #87CEEB 0%, #E0F7FA 100%);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 400px;
            position: relative;
            overflow: hidden;
        }

        .resource-area {
            background: #f5f5f5;
            border: 3px dashed #95a5a6;
            border-radius: 10px;
            padding: 15px;
            margin: 10px;
            text-align: center;
            position: relative;
        }

        .resource-area.shared-well {
            background: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 100%);
            border-color: #27ae60;
        }

        .resource-area.bridge {
            background: linear-gradient(135deg, #ffd3a5 0%, #fd9853 100%);
            border-color: #e67e22;
        }

        .resource-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .villager {
            display: inline-block;
            width: 80px;
            text-align: center;
            margin: 5px;
            padding: 8px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: all 0.3s;
            position: absolute;
        }

        .villager.moving {
            animation: move 2s ease-in-out;
        }

        .villager.waiting {
            opacity: 0.6;
            background: #fff3cd;
        }

        .villager.working {
            background: #d4edda;
            border: 2px solid #28a745;
        }

        @keyframes move {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(50px); }
        }

        .control-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            transform: scale(1.05);
        }

        .btn-primary {
            background: #9b59b6;
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-info {
            background: #3498db;
            color: white;
        }

        .uncle-dialog {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            position: relative;
        }

        .uncle-dialog::before {
            content: 'ğŸ‘´ å­—èŠ‚å”';
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #856404;
        }

        .problem-list {
            list-style: none;
            padding: 0;
        }

        .problem-item {
            background: #f8f9fa;
            border-left: 4px solid #dc3545;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 4px;
            font-size: 13px;
        }

        .solution-list {
            list-style: none;
            padding: 0;
        }

        .solution-item {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 4px;
            font-size: 13px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .stat-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }

        .stat-label {
            font-size: 12px;
            color: #6c757d;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #2c3e50;
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }

        .visual-representation {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }

        .critical-region {
            border: 3px solid #e74c3c;
            border-radius: 10px;
            padding: 15px;
            background: #ffe5e5;
            text-align: center;
            min-width: 150px;
        }

        .semaphore {
            display: inline-block;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            line-height: 40px;
            font-weight: bold;
            margin: 0 10px;
        }

        .semaphore.lock {
            background: #e74c3c;
            color: white;
        }

        .semaphore.unlock {
            background: #27ae60;
            color: white;
        }

        .log-area {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 3px 0;
            border-bottom: 1px solid #34495e;
        }

        .log-entry.error {
            color: #e74c3c;
        }

        .log-entry.success {
            color: #2ecc71;
        }

        .log-entry.info {
            color: #3498db;
        }
    </style>
</head>
<body>
    <button class="back-btn btn btn-primary" onclick="window.location.href='../../index.html'">
        â† è¿”å›æ‘åº„
    </button>

    <div class="game-container">
        <div class="game-area">
            <h1 style="text-align: center; margin-bottom: 20px;">
                ğŸ¤ æ‘æ°‘åä½œ - è¿›ç¨‹åŒæ­¥å­¦ä¹ 
            </h1>

            <div class="village-scene" id="villageScene">
                <div style="position: absolute; top: 10px; left: 50%; transform: translateX(-50%); font-size: 24px;">
                    ğŸŒ„ æ™ºæ…§æ‘åä½œåœºæ™¯
                </div>

                <div class="visual-representation">
                    <div class="villager" id="villager1" style="left: 10%; top: 50%;">
                        ğŸ‘¨â€ğŸŒ¾<br>
                        <small>æ‘æ°‘A</small><br>
                        <span class="status">ç­‰å¾…</span>
                    </div>

                    <div class="critical-region" id="criticalRegion" style="left: 40%; top: 45%;">
                        ğŸš°<br>
                        <strong>å…¬å…±æ°´äº•</strong><br>
                        <small>ä¸´ç•ŒåŒº</small><br>
                        <span class="semaphore unlock" id="semaphore">ğŸ”“</span>
                    </div>

                    <div class="villager" id="villager2" style="right: 10%; top: 50%;">
                        ğŸ‘©â€ğŸŒ¾<br>
                        <small>æ‘æ°‘B</small><br>
                        <span class="status">ç­‰å¾…</span>
                    </div>
                </div>
            </div>

            <div class="log-area" id="logArea">
                <div class="log-entry info">ç³»ç»Ÿ: æ¬¢è¿æ¥åˆ°æ‘æ°‘åä½œæ¸¸æˆï¼</div>
                <div class="log-entry info">ç³»ç»Ÿ: è¯·é€‰æ‹©ä¸€ä¸ªåŒæ­¥æœºåˆ¶å¼€å§‹å­¦ä¹ </div>
            </div>

            <div class="control-buttons">
                <button class="btn btn-primary" onclick="game.startDemo()">â–¶ å¼€å§‹æ¼”ç¤º</button>
                <button class="btn btn-warning" onclick="game.resetDemo()">â†» é‡ç½®</button>
                <button class="btn btn-success" onclick="game.showHint()">ğŸ’¡ è·å–æç¤º</button>
                <button class="btn btn-info" onclick="game.toggleRaceCondition()">âš¡ æ˜¾ç¤ºç«æ€é—®é¢˜</button>
            </div>

            <div class="uncle-dialog" id="uncleDialog">
                æ¬¢è¿æ¥åˆ°æ‘æ°‘åä½œï¼æˆ‘æ˜¯å­—èŠ‚å”ã€‚
                åœ¨è¿™é‡Œï¼Œä½ å°†å­¦ä¹ å¦‚ä½•åè°ƒå¤šä¸ªè¿›ç¨‹ï¼ˆæ‘æ°‘ï¼‰å…±åŒå·¥ä½œï¼Œ
                é¿å…å†²çªå’Œæ··ä¹±ã€‚è®©æˆ‘ä»¬ä»æœ€ç»å…¸çš„"å…¬å…±æ°´äº•"é—®é¢˜å¼€å§‹å§ï¼
            </div>
        </div>

        <div class="side-panel">
            <div class="panel-card">
                <div class="panel-title">ğŸ” é€‰æ‹©åŒæ­¥æœºåˆ¶</div>
                <button class="sync-mechanism-btn active" onclick="game.setMechanism('mutex')">
                    ğŸ”’ äº’æ–¥é” (Mutex)
                </button>
                <button class="sync-mechanism-btn" onclick="game.setMechanism('semaphore')">
                    ğŸš¦ ä¿¡å·é‡ (Semaphore)
                </button>
                <button class="sync-mechanism-btn" onclick="game.setMechanism('monitor')">
                    ğŸ“Š ç®¡ç¨‹ (Monitor)
                </button>
                <button class="sync-mechanism-btn" onclick="game.setMechanism('barrier')">
                    ğŸš§ å±éšœ (Barrier)
                </button>
            </div>

            <div class="panel-card">
                <div class="panel-title">âš ï¸ åŒæ­¥é—®é¢˜</div>
                <ul class="problem-list">
                    <li class="problem-item">
                        <strong>ç«æ€æ¡ä»¶</strong><br>
                        å¤šä¸ªè¿›ç¨‹åŒæ—¶è®¿é—®å…±äº«èµ„æºå¯¼è‡´ç»“æœä¸ç¡®å®š
                    </li>
                    <li class="problem-item">
                        <strong>æ­»é”</strong><br>
                        ä¸¤ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æº
                    </li>
                    <li class="problem-item">
                        <strong>é¥¥é¥¿</strong><br>
                        æŸäº›è¿›ç¨‹é•¿æ—¶é—´å¾—ä¸åˆ°æ‰€éœ€èµ„æº
                    </li>
                </ul>
            </div>

            <div class="panel-card">
                <div class="panel-title">âœ… è§£å†³æ–¹æ¡ˆ</div>
                <ul class="solution-list" id="solutionList">
                    <li class="solution-item">
                        <strong>äº’æ–¥é”</strong><br>
                        ç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªè¿›ç¨‹è®¿é—®ä¸´ç•ŒåŒº
                    </li>
                </ul>
            </div>

            <div class="panel-card">
                <div class="panel-title">ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">è®¿é—®æ¬¡æ•°</div>
                        <div class="stat-value" id="accessCount">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">å†²çªæ¬¡æ•°</div>
                        <div class="stat-value" id="conflictCount">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">ç­‰å¾…æ—¶é—´</div>
                        <div class="stat-value" id="waitTime">0ms</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">æˆåŠŸåŒæ­¥</div>
                        <div class="stat-value" id="syncSuccess">0</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../../common/api-client.js"></script>
    <script>
        class ProcessSyncGame {
            constructor() {
                this.mechanism = 'mutex';
                this.isRunning = false;
                this.accessCount = 0;
                this.conflictCount = 0;
                this.waitTime = 0;
                this.syncSuccess = 0;
                this.lockHeldBy = null;
                this.showRaceConditionDemo = false;
            }

            init() {
                this.resetDemo();
                this.updateSolutionInfo();
            }

            setMechanism(mechanism) {
                this.mechanism = mechanism;
                document.querySelectorAll('.sync-mechanism-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');
                this.resetDemo();
                this.updateSolutionInfo();
                this.addLog('info', `åˆ‡æ¢åˆ°åŒæ­¥æœºåˆ¶: ${mechanism}`);
            }

            updateSolutionInfo() {
                const solutions = {
                    'mutex': '<li class="solution-item"><strong>äº’æ–¥é”</strong><br>ç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªè¿›ç¨‹è®¿é—®ä¸´ç•ŒåŒºï¼Œå°±åƒæ°´äº•ä¸€æ¬¡åªèƒ½ä¸€ä¸ªäººæ‰“æ°´ã€‚</li>',
                    'semaphore': '<li class="solution-item"><strong>ä¿¡å·é‡</strong><br>ä½¿ç”¨æ•´å‹å˜é‡æ§åˆ¶åŒæ—¶è®¿é—®èµ„æºçš„è¿›ç¨‹æ•°é‡ï¼Œå¯ä»¥æ§åˆ¶åŒæ—¶æœ‰å‡ ä¸ªæ‘æ°‘ä½¿ç”¨æ°´äº•ã€‚</li>',
                    'monitor': '<li class="solution-item"><strong>ç®¡ç¨‹</strong><br>é«˜çº§åŒæ­¥åŸè¯­ï¼Œå°è£…äº†å…±äº«æ•°æ®å’Œæ“ä½œï¼Œè‡ªåŠ¨å¤„ç†åŒæ­¥ï¼Œå°±åƒæœ‰ä¸ªç®¡ç†å‘˜åè°ƒæ°´äº•ä½¿ç”¨ã€‚</li>',
                    'barrier': '<li class="solution-item"><strong>å±éšœ</strong><br>ç¡®ä¿æ‰€æœ‰è¿›ç¨‹éƒ½åˆ°è¾¾æŸä¸ªç‚¹åæ‰ç»§ç»­ï¼Œå°±åƒç­‰å¾…æ‰€æœ‰äººé›†åˆåå†ä¸€èµ·å‡ºå‘ã€‚</li>'
                };
                document.getElementById('solutionList').innerHTML = solutions[this.mechanism];
            }

            async startDemo() {
                if (this.isRunning) return;
                this.isRunning = true;
                this.addLog('info', `å¼€å§‹æ¼”ç¤º ${this.mechanism} æœºåˆ¶...`);

                if (this.showRaceConditionDemo) {
                    await this.demonstrateRaceCondition();
                } else {
                    await this.demonstrateSynchronization();
                }

                this.isRunning = false;
            }

            async demonstrateSynchronization() {
                const villager1 = document.getElementById('villager1');
                const villager2 = document.getElementById('villager2');
                const semaphore = document.getElementById('semaphore');

                // æ‘æ°‘Aå°è¯•è·å–é”
                this.addLog('info', 'æ‘æ°‘A è¯·æ±‚è·å–é”...');
                villager1.querySelector('.status').textContent = 'è¯·æ±‚ä¸­';
                await this.sleep(800);

                if (this.lockHeldBy === null) {
                    this.lockHeldBy = 'A';
                    semaphore.className = 'semaphore lock';
                    semaphore.textContent = 'ğŸ”’';
                    villager1.querySelector('.status').textContent = 'ä½¿ç”¨ä¸­';
                    villager1.classList.add('working');
                    this.addLog('success', 'æ‘æ°‘A è·å¾—é”ï¼Œå¼€å§‹ä½¿ç”¨æ°´äº•');
                    this.accessCount++;
                    this.syncSuccess++;

                    await this.sleep(2000);

                    this.addLog('success', 'æ‘æ°‘A å®Œæˆæ‰“æ°´ï¼Œé‡Šæ”¾é”');
                    this.lockHeldBy = null;
                    semaphore.className = 'semaphore unlock';
                    semaphore.textContent = 'ğŸ”“';
                    villager1.classList.remove('working');
                    villager1.querySelector('.status').textContent = 'å®Œæˆ';
                }

                await this.sleep(500);

                // æ‘æ°‘Bå°è¯•è·å–é”
                this.addLog('info', 'æ‘æ°‘B è¯·æ±‚è·å–é”...');
                villager2.querySelector('.status').textContent = 'è¯·æ±‚ä¸­';
                await this.sleep(800);

                if (this.lockHeldBy === null) {
                    this.lockHeldBy = 'B';
                    semaphore.className = 'semaphore lock';
                    semaphore.textContent = 'ğŸ”’';
                    villager2.querySelector('.status').textContent = 'ä½¿ç”¨ä¸­';
                    villager2.classList.add('working');
                    this.addLog('success', 'æ‘æ°‘B è·å¾—é”ï¼Œå¼€å§‹ä½¿ç”¨æ°´äº•');
                    this.accessCount++;
                    this.syncSuccess++;

                    await this.sleep(2000);

                    this.addLog('success', 'æ‘æ°‘B å®Œæˆæ‰“æ°´ï¼Œé‡Šæ”¾é”');
                    this.lockHeldBy = null;
                    semaphore.className = 'semaphore unlock';
                    semaphore.textContent = 'ğŸ”“';
                    villager2.classList.remove('working');
                    villager2.querySelector('.status').textContent = 'å®Œæˆ';
                }

                this.updateStats();
                this.showCompletionMessage();
            }

            async demonstrateRaceCondition() {
                const villager1 = document.getElementById('villager1');
                const villager2 = document.getElementById('villager2');
                const semaphore = document.getElementById('semaphore');

                this.addLog('error', 'âš ï¸ æ¼”ç¤ºç«æ€æ¡ä»¶ï¼šæ²¡æœ‰æ­£ç¡®çš„åŒæ­¥ï¼');

                // ä¸¤ä¸ªæ‘æ°‘åŒæ—¶å°è¯•è®¿é—®
                villager1.querySelector('.status').textContent = 'å†²å‘æ°´äº•';
                villager2.querySelector('.status').textContent = 'å†²å‘æ°´äº•';
                villager1.classList.add('moving');
                villager2.classList.add('moving');

                await this.sleep(1000);

                villager1.classList.remove('moving');
                villager2.classList.remove('moving');

                this.addLog('error', 'âŒ å†²çªï¼ä¸¤ä¸ªæ‘æ°‘åŒæ—¶åˆ°è¾¾æ°´äº•');
                this.conflictCount++;

                villager1.querySelector('.status').textContent = 'å†²çªï¼';
                villager2.querySelector('.status').textContent = 'å†²çªï¼';
                villager1.classList.add('waiting');
                villager2.classList.add('waiting');

                await this.sleep(1500);

                this.addLog('error', 'ğŸ’¥ å‘ç”Ÿæ•°æ®ç«äº‰ï¼Œå¯èƒ½å¯¼è‡´æ°´èµ„æºç»Ÿè®¡é”™è¯¯');
                this.addLog('info', 'ğŸ’¡ è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨äº’æ–¥é”ç¡®ä¿äº’æ–¥è®¿é—®');

                this.updateStats();
                this.showRaceConditionWarning();
            }

            toggleRaceCondition() {
                this.showRaceConditionDemo = !this.showRaceConditionDemo;
                const btn = event.target;
                if (this.showRaceConditionDemo) {
                    btn.textContent = 'âš¡ éšè—ç«æ€é—®é¢˜';
                    btn.style.background = '#e74c3c';
                    this.addLog('info', 'å·²åˆ‡æ¢åˆ°ç«æ€æ¡ä»¶æ¼”ç¤ºæ¨¡å¼');
                } else {
                    btn.textContent = 'âš¡ æ˜¾ç¤ºç«æ€é—®é¢˜';
                    btn.style.background = '#3498db';
                    this.addLog('info', 'å·²åˆ‡æ¢åˆ°æ­£å¸¸åŒæ­¥æ¼”ç¤ºæ¨¡å¼');
                }
            }

            resetDemo() {
                this.isRunning = false;
                this.lockHeldBy = null;
                this.accessCount = 0;
                this.conflictCount = 0;
                this.waitTime = 0;
                this.syncSuccess = 0;

                const villager1 = document.getElementById('villager1');
                const villager2 = document.getElementById('villager2');
                const semaphore = document.getElementById('semaphore');

                villager1.querySelector('.status').textContent = 'ç­‰å¾…';
                villager2.querySelector('.status').textContent = 'ç­‰å¾…';
                villager1.classList.remove('working', 'waiting', 'moving');
                villager2.classList.remove('working', 'waiting', 'moving');
                semaphore.className = 'semaphore unlock';
                semaphore.textContent = 'ğŸ”“';

                document.getElementById('logArea').innerHTML =
                    '<div class="log-entry info">ç³»ç»Ÿ: æ¼”ç¤ºå·²é‡ç½®</div>';

                this.updateStats();
            }

            updateStats() {
                document.getElementById('accessCount').textContent = this.accessCount;
                document.getElementById('conflictCount').textContent = this.conflictCount;
                document.getElementById('waitTime').textContent = this.waitTime + 'ms';
                document.getElementById('syncSuccess').textContent = this.syncSuccess;
            }

            addLog(type, message) {
                const logArea = document.getElementById('logArea');
                const entry = document.createElement('div');
                entry.className = `log-entry ${type}`;
                entry.textContent = message;
                logArea.appendChild(entry);
                logArea.scrollTop = logArea.scrollHeight;
            }

            async showHint() {
                try {
                    const hint = await OS_VILLAGE_API.getHint(
                        'session_' + Date.now(),
                        {
                            game: 'process-sync',
                            mechanism: this.mechanism,
                            stage: 'learning'
                        }
                    );
                    document.getElementById('uncleDialog').innerHTML =
                        'ğŸ‘´ å­—èŠ‚å”<br>' + hint.hint;
                } catch (error) {
                    document.getElementById('uncleDialog').innerHTML =
                        'ğŸ‘´ å­—èŠ‚å”<br>' + this.getOfflineHint();
                }
            }

            getOfflineHint() {
                const hints = {
                    'mutex': 'äº’æ–¥é”å°±åƒæ°´äº•çš„é’¥åŒ™ï¼ä¸€æ¬¡åªèƒ½æœ‰ä¸€æŠŠé’¥åŒ™ï¼Œæ‘æ°‘Aç”¨å®Œåè¦äº¤å‡ºæ¥ï¼Œæ‘æ°‘Bæ‰èƒ½ä½¿ç”¨ã€‚',
                    'semaphore': 'ä¿¡å·é‡åƒæ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼å¯ä»¥è®¾ç½®åŒæ—¶å…è®¸å¤šå°‘ä¸ªæ‘æ°‘ä½¿ç”¨æ°´äº•ï¼Œæ¯”å¦‚è®¾ä¸º2ï¼Œå°±å¯ä»¥æœ‰2ä¸ªæ‘æ°‘åŒæ—¶ä½¿ç”¨ã€‚',
                    'monitor': 'ç®¡ç¨‹å°±åƒæœ‰ä¸ªè‡ªåŠ¨ç®¡ç†å‘˜ï¼æ‘æ°‘åªéœ€æ’é˜Ÿï¼Œç®¡ç†å‘˜ä¼šè‡ªåŠ¨åè°ƒè°å…ˆè°åï¼Œä¸ç”¨è‡ªå·±å¤„ç†é”ã€‚',
                    'barrier': 'å±éšœå°±åƒé›†åˆç‚¹ï¼æ‰€æœ‰æ‘æ°‘éƒ½è¦åˆ°è¾¾åæ‰èƒ½ä¸€èµ·ç»§ç»­ï¼Œç¡®ä¿å¤§å®¶åŒæ­¥å®ŒæˆæŸä¸ªé˜¶æ®µã€‚'
                };
                return hints[this.mechanism];
            }

            showCompletionMessage() {
                const messages = [
                    'å¤ªæ£’äº†ï¼ä½ å·²ç»ç†è§£äº†è¿›ç¨‹åŒæ­¥çš„æ ¸å¿ƒæ¦‚å¿µï¼',
                    'åšå¾—å¾ˆå¥½ï¼äº’æ–¥è®¿é—®æ˜¯é˜²æ­¢ç«æ€æ¡ä»¶çš„å…³é”®ï¼',
                    'ä½ æ˜¯ä¸ªåŒæ­¥ä¸“å®¶ï¼å­—èŠ‚å”ä¸ºä½ éª„å‚²ï¼'
                ];
                const msg = messages[Math.floor(Math.random() * messages.length)];
                document.getElementById('uncleDialog').innerHTML =
                    'ğŸ‘´ å­—èŠ‚å”<br>' + msg;
            }

            showRaceConditionWarning() {
                document.getElementById('uncleDialog').innerHTML =
                    'ğŸ‘´ å­—èŠ‚å”<br>' +
                    'è¿™å°±æ˜¯<strong>ç«æ€æ¡ä»¶</strong>çš„å±å®³ï¼æ²¡æœ‰æ­£ç¡®çš„åŒæ­¥æœºåˆ¶ï¼Œ<br>' +
                    'å¤šä¸ªè¿›ç¨‹åŒæ—¶è®¿é—®å…±äº«èµ„æºä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚<br><br>' +
                    'ğŸ’¡ è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨äº’æ–¥é”ã€ä¿¡å·é‡ç­‰åŒæ­¥æœºåˆ¶ï¼';
            }

            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        const game = new ProcessSyncGame();
        game.init();
    </script>
</body>
</html>
