<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»“åº“ç²®é£Ÿç®¡ç† - å†…å­˜ç®¡ç†å­¦ä¹ </title>
    <link rel="stylesheet" href="../../styles/main.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .game-wrapper {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .game-container {
            display: flex;
            padding: 20px;
            gap: 20px;
        }

        .main-area {
            flex: 1;
        }

        .side-panel {
            width: 350px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .panel {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .panel-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* å†…å­˜å¯è§†åŒ–åŒºåŸŸ */
        .memory-container {
            background: #fff;
            border: 3px solid #3498db;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .memory-block {
            display: flex;
            margin-bottom: 10px;
            align-items: center;
        }

        .memory-address {
            width: 80px;
            font-size: 14px;
            color: #7f8c8d;
            text-align: right;
            padding-right: 10px;
        }

        .memory-cell {
            flex: 1;
            height: 50px;
            background: #ecf0f1;
            border: 2px solid #bdc3c7;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            position: relative;
            transition: all 0.3s;
        }

        .memory-cell.occupied {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .memory-cell.free {
            background: #d5f4e6;
            border-color: #27ae60;
            border-style: dashed;
        }

        .memory-cell.fragmented {
            background: #ffeaa7;
            border-color: #f39c12;
        }

        /* ç²®é£Ÿåˆ—è¡¨ */
        .food-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
        }

        .food-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            cursor: pointer;
            transition: all 0.3s;
        }

        .food-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .food-item.allocated {
            opacity: 0.5;
            background: #ecf0f1;
        }

        .food-icon {
            font-size: 24px;
        }

        .food-info {
            flex: 1;
        }

        .food-name {
            font-weight: bold;
            color: #2c3e50;
        }

        .food-size {
            font-size: 12px;
            color: #7f8c8d;
        }

        /* æ§åˆ¶æŒ‰é’® */
        .control-btn {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .control-btn:hover {
            transform: scale(1.02);
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        /* ç»Ÿè®¡ä¿¡æ¯ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .stat-box {
            background: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #3498db;
        }

        .stat-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 4px;
        }

        /* å­—èŠ‚å”å¯¹è¯æ¡† */
        .uncle-dialog {
            background: #fff3cd;
            border: 3px solid #ffc107;
            border-radius: 15px;
            padding: 20px;
            margin-top: 15px;
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .uncle-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            color: #856404;
            font-weight: bold;
        }

        .uncle-avatar {
            font-size: 32px;
        }

        .uncle-message {
            color: #856404;
            line-height: 1.6;
        }

        /* ç®—æ³•é€‰æ‹©æ ‡ç­¾ */
        .algorithm-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .tab-btn {
            flex: 1;
            min-width: 120px;
            padding: 10px;
            border: 2px solid #3498db;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
        }

        .tab-btn:hover {
            background: #ecf0f1;
        }

        .tab-btn.active {
            background: #3498db;
            color: white;
        }

        /* é¡µé¢ç½®æ¢å¯è§†åŒ– */
        .page-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .page-table th,
        .page-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }

        .page-table th {
            background: #3498db;
            color: white;
        }

        .page-table tr:nth-child(even) {
            background: #f2f2f2;
        }

        .page-hit {
            background: #d4edda !important;
            color: #155724;
        }

        .page-miss {
            background: #f8d7da !important;
            color: #721c24;
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            padding: 12px 24px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .back-btn:hover {
            transform: scale(1.05);
            background: #2980b9;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-in {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="window.location.href='../../index.html'">
        â† è¿”å›æ‘åº„
    </button>

    <div class="game-wrapper">
        <div class="header">
            <h1>ğŸ  ä»“åº“ç²®é£Ÿç®¡ç† - å†…å­˜ç®¡ç†å­¦ä¹ </h1>
            <p>å­¦ä¹ å¦‚ä½•é«˜æ•ˆåœ°ç®¡ç†ç²®ä»“ç©ºé—´ï¼Œå°±åƒæ“ä½œç³»ç»Ÿç®¡ç†å†…å­˜ä¸€æ ·ï¼</p>
        </div>

        <div class="game-container">
            <div class="main-area">
                <!-- ç®—æ³•é€‰æ‹© -->
                <div class="panel">
                    <div class="panel-title">ğŸ“š é€‰æ‹©å†…å­˜ç®¡ç†æ–¹å¼</div>
                    <div class="algorithm-tabs">
                        <button class="tab-btn active" onclick="game.setMode('fixed')">
                            å›ºå®šåˆ†åŒº
                        </button>
                        <button class="tab-btn" onclick="game.setMode('variable')">
                            å¯å˜åˆ†åŒº
                        </button>
                        <button class="tab-btn" onclick="game.setMode('paging')">
                            åˆ†é¡µç®¡ç†
                        </button>
                        <button class="tab-btn" onclick="game.setMode('virtual')">
                            è™šæ‹Ÿå†…å­˜
                        </button>
                    </div>
                </div>

                <!-- å†…å­˜å¯è§†åŒ– -->
                <div class="memory-container">
                    <h3 style="margin-bottom: 15px; color: #2c3e50;">
                        ğŸ“ ç²®ä»“ç©ºé—´å¸ƒå±€ï¼ˆå†…å­˜ç©ºé—´ï¼‰
                    </h3>
                    <div id="memoryVisualization"></div>
                </div>

                <!-- å­—èŠ‚å”å¯¹è¯æ¡† -->
                <div class="uncle-dialog">
                    <div class="uncle-header">
                        <span class="uncle-avatar">ğŸ‘´</span>
                        <span>å­—èŠ‚å”</span>
                    </div>
                    <div class="uncle-message" id="uncleMessage">
                        æ¬¢è¿æ¥åˆ°ä»“åº“ç²®é£Ÿç®¡ç†ï¼ç²®ä»“å°±åƒè®¡ç®—æœºçš„å†…å­˜ï¼Œæˆ‘ä»¬éœ€è¦åˆç†åˆ†é…ç©ºé—´æ¥å­˜å‚¨ä¸åŒçš„ç²®é£Ÿã€‚
                        é€‰æ‹©ä¸€ç§å†…å­˜ç®¡ç†æ–¹å¼å¼€å§‹å­¦ä¹ å§ï¼
                    </div>
                </div>
            </div>

            <div class="side-panel">
                <!-- å¾…åˆ†é…ç²®é£Ÿ -->
                <div class="panel">
                    <div class="panel-title">ğŸŒ¾ å¾…å­˜å‚¨ç²®é£Ÿï¼ˆè¿›ç¨‹ï¼‰</div>
                    <div class="food-list" id="foodList"></div>
                    <button class="control-btn btn-success" onclick="game.allocateNext()">
                        âœ… åˆ†é…ä¸‹ä¸€ä¸ª
                    </button>
                </div>

                <!-- æ§åˆ¶é¢æ¿ -->
                <div class="panel">
                    <div class="panel-title">ğŸ® æ§åˆ¶é¢æ¿</div>
                    <button class="control-btn btn-warning" onclick="game.compactMemory()">
                        ğŸ”„ ç¢ç‰‡æ•´ç†
                    </button>
                    <button class="control-btn btn-danger" onclick="game.reset()">
                        ğŸ”ƒ é‡æ–°å¼€å§‹
                    </button>
                    <button class="control-btn btn-primary" onclick="game.showHint()">
                        ğŸ’¡ è·å–æç¤º
                    </button>
                </div>

                <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                <div class="panel">
                    <div class="panel-title">ğŸ“Š å­˜å‚¨ç»Ÿè®¡</div>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-value" id="totalMemory">64</div>
                            <div class="stat-label">æ€»å®¹é‡(KB)</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="usedMemory">0</div>
                            <div class="stat-label">å·²ä½¿ç”¨(KB)</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="freeMemory">64</div>
                            <div class="stat-label">ç©ºé—²(KB)</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="fragmentation">0%</div>
                            <div class="stat-label">ç¢ç‰‡ç‡</div>
                        </div>
                    </div>
                </div>

                <!-- ç®—æ³•è¯´æ˜ -->
                <div class="panel">
                    <div class="panel-title">ğŸ“– ç®—æ³•è¯´æ˜</div>
                    <div id="algorithmInfo">
                        <strong>å›ºå®šåˆ†åŒºåˆ†é…</strong><br>
                        å°†å†…å­˜åˆ’åˆ†ä¸ºå›ºå®šå¤§å°çš„åˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºåªèƒ½å­˜æ”¾ä¸€ä¸ªè¿›ç¨‹ã€‚
                        ä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼Œç¼ºç‚¹æ˜¯ä¼šäº§ç”Ÿå†…éƒ¨ç¢ç‰‡ã€‚
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../../common/api-client.js"></script>
    <script>
        class MemoryGame {
            constructor() {
                this.mode = 'fixed';
                this.memorySize = 64; // KB
                this.partitionSize = 16; // KB for fixed partitions
                this.memory = [];
                this.foods = [];
                this.allocatedCount = 0;

                this.foodTypes = [
                    { name: 'å°éº¦', size: 8, icon: 'ğŸŒ¾' },
                    { name: 'ç‰ç±³', size: 12, icon: 'ğŸŒ½' },
                    { name: 'å¤§ç±³', size: 16, icon: 'ğŸš' },
                    { name: 'å¤§è±†', size: 6, icon: 'ğŸ«˜' },
                    { name: 'é«˜ç²±', size: 10, icon: 'ğŸŒ¾' },
                    { name: 'è°·å­', size: 8, icon: 'ğŸŒ¾' }
                ];

                this.init();
            }

            init() {
                this.initMemory();
                this.generateFoods();
                this.renderMemory();
                this.renderFoods();
                this.updateStats();
                this.updateAlgorithmInfo();
            }

            initMemory() {
                this.memory = [];

                if (this.mode === 'fixed') {
                    // å›ºå®šåˆ†åŒºï¼š4ä¸ª16KBçš„åˆ†åŒº
                    for (let i = 0; i < 4; i++) {
                        this.memory.push({
                            start: i * 16,
                            end: (i + 1) * 16,
                            size: 16,
                            allocated: false,
                            process: null,
                            type: 'fixed'
                        });
                    }
                } else if (this.mode === 'variable') {
                    // å¯å˜åˆ†åŒºï¼šåˆå§‹ä¸€ä¸ªå¤§åˆ†åŒº
                    this.memory.push({
                        start: 0,
                        end: 64,
                        size: 64,
                        allocated: false,
                        process: null,
                        type: 'variable'
                    });
                } else if (this.mode === 'paging') {
                    // åˆ†é¡µï¼š16ä¸ª4KBçš„é¡µé¢
                    for (let i = 0; i < 16; i++) {
                        this.memory.push({
                            start: i * 4,
                            end: (i + 1) * 4,
                            size: 4,
                            allocated: false,
                            process: null,
                            type: 'page',
                            pageNumber: i
                        });
                    }
                } else if (this.mode === 'virtual') {
                    // è™šæ‹Ÿå†…å­˜ï¼š8ä¸ªç‰©ç†é¡µ
                    for (let i = 0; i < 8; i++) {
                        this.memory.push({
                            start: i * 8,
                            end: (i + 1) * 8,
                            size: 8,
                            allocated: false,
                            process: null,
                            type: 'physical'
                        });
                    }
                }
            }

            generateFoods() {
                this.foods = [];
                for (let i = 0; i < 6; i++) {
                    const type = this.foodTypes[i % this.foodTypes.length];
                    this.foods.push({
                        id: i,
                        ...type,
                        allocated: false
                    });
                }
            }

            renderMemory() {
                const container = document.getElementById('memoryVisualization');
                container.innerHTML = '';

                this.memory.forEach((block, index) => {
                    const blockDiv = document.createElement('div');
                    blockDiv.className = 'memory-block animate-in';

                    const addressDiv = document.createElement('div');
                    addressDiv.className = 'memory-address';
                    addressDiv.textContent = `0x${(block.start).toString(16).toUpperCase().padStart(2, '0')}`;

                    const cellDiv = document.createElement('div');
                    cellDiv.className = 'memory-cell';

                    if (block.allocated) {
                        cellDiv.classList.add('occupied');
                        cellDiv.textContent = `${block.process} (${block.size}KB)`;
                    } else if (this.mode === 'variable' && block.size < 64) {
                        cellDiv.classList.add('fragmented');
                        cellDiv.textContent = `ç©ºé—² ${block.size}KB`;
                    } else {
                        cellDiv.classList.add('free');
                        cellDiv.textContent = this.mode === 'paging' ? `é¡µ${block.pageNumber}` : 'ç©ºé—²';
                    }

                    blockDiv.appendChild(addressDiv);
                    blockDiv.appendChild(cellDiv);
                    container.appendChild(blockDiv);
                });
            }

            renderFoods() {
                const container = document.getElementById('foodList');
                container.innerHTML = '';

                this.foods.forEach(food => {
                    if (!food.allocated) {
                        const foodDiv = document.createElement('div');
                        foodDiv.className = 'food-item animate-in';
                        foodDiv.innerHTML = `
                            <span class="food-icon">${food.icon}</span>
                            <div class="food-info">
                                <div class="food-name">${food.name}</div>
                                <div class="food-size">å¤§å°: ${food.size}KB</div>
                            </div>
                        `;
                        container.appendChild(foodDiv);
                    }
                });
            }

            allocateNext() {
                const unallocatedFood = this.foods.find(f => !f.allocated);
                if (!unallocatedFood) {
                    this.showMessage('æ‰€æœ‰ç²®é£Ÿéƒ½å·²ç»åˆ†é…å®Œæ¯•ï¼ğŸ‘');
                    return;
                }

                let allocated = false;

                if (this.mode === 'fixed') {
                    allocated = this.allocateFixed(unallocatedFood);
                } else if (this.mode === 'variable') {
                    allocated = this.allocateVariable(unallocatedFood);
                } else if (this.mode === 'paging') {
                    allocated = this.allocatePaging(unallocatedFood);
                } else if (this.mode === 'virtual') {
                    allocated = this.allocateVirtual(unallocatedFood);
                }

                if (allocated) {
                    unallocatedFood.allocated = true;
                    this.allocatedCount++;
                    this.renderMemory();
                    this.renderFoods();
                    this.updateStats();

                    if (this.allocatedCount === this.foods.length) {
                        this.showMessage('å¤ªæ£’äº†ï¼æ‰€æœ‰ç²®é£Ÿéƒ½æˆåŠŸåˆ†é…äº†ï¼ä½ å·²ç»æŒæ¡äº†' + this.getModeName() + 'ï¼ğŸ‰');
                    }
                } else {
                    this.showMessage('å“å‘€ï¼æ²¡æœ‰è¶³å¤Ÿçš„è¿ç»­ç©ºé—´äº†ã€‚è¯•è¯•ç¢ç‰‡æ•´ç†åŠŸèƒ½å§ï¼');
                }
            }

            allocateFixed(food) {
                // é¦–æ¬¡é€‚åº”ç®—æ³•
                for (let block of this.memory) {
                    if (!block.allocated && block.size >= food.size) {
                        block.allocated = true;
                        block.process = food.name;
                        return true;
                    }
                }
                return false;
            }

            allocateVariable(food) {
                // é¦–æ¬¡é€‚åº”ç®—æ³•
                for (let i = 0; i < this.memory.length; i++) {
                    const block = this.memory[i];
                    if (!block.allocated && block.size >= food.size) {
                        // åˆ†é…ç©ºé—´
                        const newBlock = {
                            start: block.start,
                            end: block.start + food.size,
                            size: food.size,
                            allocated: true,
                            process: food.name,
                            type: 'variable'
                        };

                        // å‰©ä½™ç©ºé—´
                        const remainingBlock = {
                            start: block.start + food.size,
                            end: block.end,
                            size: block.size - food.size,
                            allocated: false,
                            process: null,
                            type: 'variable'
                        };

                        this.memory.splice(i, 1, newBlock);
                        if (remainingBlock.size > 0) {
                            this.memory.splice(i + 1, 0, remainingBlock);
                        }
                        return true;
                    }
                }
                return false;
            }

            allocatePaging(food) {
                // éœ€è¦çš„é¡µæ•°
                const pagesNeeded = Math.ceil(food.size / 4);
                let allocatedPages = 0;

                for (let block of this.memory) {
                    if (!block.allocated) {
                        block.allocated = true;
                        block.process = food.name + '(é¡µ' + block.pageNumber + ')';
                        allocatedPages++;

                        if (allocatedPages === pagesNeeded) {
                            return true;
                        }
                    }
                }
                return false;
            }

            allocateVirtual(food) {
                // ç®€åŒ–çš„è™šæ‹Ÿå†…å­˜åˆ†é…
                for (let block of this.memory) {
                    if (!block.allocated && block.size >= food.size) {
                        block.allocated = true;
                        block.process = food.name;
                        return true;
                    }
                }
                // å¦‚æœç‰©ç†å†…å­˜æ»¡äº†ï¼Œæç¤ºéœ€è¦é¡µé¢ç½®æ¢
                this.showMessage('ç‰©ç†å†…å­˜å·²æ»¡ï¼åœ¨å®é™…çš„è™šæ‹Ÿå†…å­˜ç³»ç»Ÿä¸­ï¼Œç³»ç»Ÿä¼šå°†ä¸å¸¸ç”¨çš„é¡µæ¢å‡ºåˆ°ç£ç›˜ã€‚');
                return false;
            }

            compactMemory() {
                if (this.mode !== 'variable') {
                    this.showMessage('åªæœ‰å¯å˜åˆ†åŒºæ¨¡å¼éœ€è¦ç¢ç‰‡æ•´ç†ï¼');
                    return;
                }

                // åˆå¹¶ç›¸é‚»çš„ç©ºé—²å—
                let merged = true;
                while (merged) {
                    merged = false;
                    for (let i = 0; i < this.memory.length - 1; i++) {
                        if (!this.memory[i].allocated && !this.memory[i + 1].allocated) {
                            this.memory[i].end = this.memory[i + 1].end;
                            this.memory[i].size += this.memory[i + 1].size;
                            this.memory.splice(i + 1, 1);
                            merged = true;
                            break;
                        }
                    }
                }

                this.renderMemory();
                this.updateStats();
                this.showMessage('ç¢ç‰‡æ•´ç†å®Œæˆï¼ç°åœ¨æœ‰æ›´å¤§çš„è¿ç»­ç©ºé—´äº†ã€‚âœ¨');
            }

            setMode(mode) {
                this.mode = mode;
                this.allocatedCount = 0;

                // æ›´æ–°æ ‡ç­¾æ ·å¼
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');

                this.init();
                this.showMessage('å·²åˆ‡æ¢åˆ°' + this.getModeName() + 'æ¨¡å¼ï¼');
            }

            getModeName() {
                const names = {
                    'fixed': 'å›ºå®šåˆ†åŒº',
                    'variable': 'å¯å˜åˆ†åŒº',
                    'paging': 'åˆ†é¡µç®¡ç†',
                    'virtual': 'è™šæ‹Ÿå†…å­˜'
                };
                return names[this.mode];
            }

            updateStats() {
                const used = this.memory.filter(b => b.allocated).reduce((sum, b) => sum + b.size, 0);
                const free = this.memorySize - used;

                // è®¡ç®—ç¢ç‰‡ç‡
                let fragmentation = 0;
                if (this.mode === 'variable') {
                    const freeBlocks = this.memory.filter(b => !b.allocated);
                    if (freeBlocks.length > 1) {
                        fragmentation = Math.round((1 - free / (freeBlocks.length * Math.max(...freeBlocks.map(b => b.size)))) * 100);
                    }
                }

                document.getElementById('totalMemory').textContent = this.memorySize;
                document.getElementById('usedMemory').textContent = used;
                document.getElementById('freeMemory').textContent = free;
                document.getElementById('fragmentation').textContent = fragmentation + '%';
            }

            updateAlgorithmInfo() {
                const infos = {
                    'fixed': '<strong>å›ºå®šåˆ†åŒºåˆ†é…</strong><br>å°†å†…å­˜åˆ’åˆ†ä¸ºå›ºå®šå¤§å°çš„åˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºåªèƒ½å­˜æ”¾ä¸€ä¸ªè¿›ç¨‹ã€‚ä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼Œç¼ºç‚¹æ˜¯ä¼šäº§ç”Ÿå†…éƒ¨ç¢ç‰‡ã€‚',
                    'variable': '<strong>å¯å˜åˆ†åŒºåˆ†é…</strong><br>æ ¹æ®è¿›ç¨‹å¤§å°åŠ¨æ€åˆ’åˆ†å†…å­˜ã€‚ä¼˜ç‚¹æ˜¯å†…å­˜åˆ©ç”¨ç‡é«˜ï¼Œç¼ºç‚¹æ˜¯ä¼šäº§ç”Ÿå¤–éƒ¨ç¢ç‰‡ï¼Œéœ€è¦ç¢ç‰‡æ•´ç†ã€‚',
                    'paging': '<strong>åˆ†é¡µç®¡ç†</strong><br>å°†å†…å­˜åˆ’åˆ†ä¸ºå›ºå®šå¤§å°çš„é¡µï¼Œè¿›ç¨‹ä¹Ÿåˆ’åˆ†ä¸ºé¡µã€‚é€šè¿‡é¡µè¡¨æ˜ å°„ï¼Œæ¶ˆé™¤äº†å¤–éƒ¨ç¢ç‰‡ï¼Œä½†å¯èƒ½æœ‰å†…éƒ¨ç¢ç‰‡ã€‚',
                    'virtual': '<strong>è™šæ‹Ÿå†…å­˜</strong><br>å…è®¸ç¨‹åºä½¿ç”¨æ¯”ç‰©ç†å†…å­˜æ›´å¤§çš„ç©ºé—´ã€‚ä¸å¸¸ç”¨çš„é¡µè¢«æ¢å‡ºåˆ°ç£ç›˜ï¼Œéœ€è¦æ—¶å†æ¢å…¥ã€‚å¤§å¤§æé«˜äº†å†…å­˜åˆ©ç”¨ç‡ã€‚'
                };
                document.getElementById('algorithmInfo').innerHTML = infos[this.mode];
            }

            showMessage(msg) {
                document.getElementById('uncleMessage').innerHTML = msg;
            }

            reset() {
                this.init();
                this.allocatedCount = 0;
                this.showMessage('å·²é‡ç½®ï¼è®©æˆ‘ä»¬é‡æ–°å¼€å§‹å§ï¼');
            }

            async showHint() {
                try {
                    const hint = await OS_VILLAGE_API.getHint(
                        'session_' + Date.now(),
                        {
                            game: 'memory-management',
                            mode: this.mode,
                            stage: 'learning'
                        }
                    );
                    this.showMessage('ğŸ‘´ å­—èŠ‚å”<br>' + hint.hint);
                } catch (error) {
                    this.showMessage(this.getOfflineHint());
                }
            }

            getOfflineHint() {
                const hints = {
                    'fixed': 'å›ºå®šåˆ†åŒºå¾ˆç®€å•ï¼æ‰¾åˆ°ç¬¬ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ç©ºé—²åˆ†åŒºï¼ŒæŠŠç²®é£Ÿæ”¾è¿›å»å°±è¡Œã€‚å°±åƒæŠŠä¸œè¥¿æ”¾è¿›å›ºå®šå¤§å°çš„ç›’å­é‡Œã€‚',
                    'variable': 'å¯å˜åˆ†åŒºéœ€è¦æ‰¾åˆ°è¿ç»­çš„ç©ºé—²ç©ºé—´ã€‚å¦‚æœç©ºé—´ä¸å¤Ÿå¤§ï¼Œè¯•è¯•ç¢ç‰‡æ•´ç†åŠŸèƒ½ï¼',
                    'paging': 'åˆ†é¡µç®¡ç†ä¸­ï¼Œå†…å­˜è¢«åˆ†æˆ4KBçš„é¡µã€‚ç²®é£Ÿä¼šè¢«åˆ†æˆå¤šä¸ªé¡µå­˜å‚¨ã€‚è¿™æ˜¯ç°ä»£OSæœ€å¸¸ç”¨çš„æ–¹å¼ï¼',
                    'virtual': 'è™šæ‹Ÿå†…å­˜è®©ç¨‹åºå¯ä»¥ä½¿ç”¨æ¯”ç‰©ç†å†…å­˜æ›´å¤šçš„ç©ºé—´ã€‚å½“ç‰©ç†å†…å­˜æ»¡äº†ï¼Œç³»ç»Ÿä¼šæŠŠä¸ç”¨çš„å†…å®¹æ¢åˆ°ç£ç›˜ä¸Šã€‚'
                };
                return 'ğŸ‘´ å­—èŠ‚å”<br>' + hints[this.mode];
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        const game = new MemoryGame();
    </script>
</body>
</html>
