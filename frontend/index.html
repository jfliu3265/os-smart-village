<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ“ä½œç³»ç»Ÿæ™ºæ…§ä¹¡æ‘ - OS Smart Village</title>
    <link rel="stylesheet" href="../styles/main.css">
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- æ¸¸æˆå®¹å™¨ -->
        <div id="game-container"></div>

        <!-- åŠ è½½ç•Œé¢ -->
        <div id="loading-screen" class="loading-screen">
            <div class="loading-content">
                <h1>æ“ä½œç³»ç»Ÿæ™ºæ…§ä¹¡æ‘</h1>
                <div class="loading-spinner"></div>
                <p>æ­£åœ¨åŠ è½½æ‘åº„èµ„æº...</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.5/dist/axios.min.js"></script>

    <script>
        // APIé…ç½®
        const API_BASE_URL = 'http://localhost:8000';

        // åˆ›å»ºå…¨å±€axioså®ä¾‹
        const api = axios.create({
            baseURL: API_BASE_URL,
            timeout: 10000,
            headers: {
                'Content-Type': 'application/json'
            }
        });

        // æ¸¸æˆé…ç½®
        const GAMES = [
            {
                id: 'process-scheduling',
                name: 'å†œç”°ä½œä¸šè°ƒåº¦',
                subtitle: 'è¿›ç¨‹è°ƒåº¦',
                icon: 'ğŸŒ¾',
                description: 'å­¦ä¹ FCFSã€SJFã€æ—¶é—´ç‰‡è½®è½¬ç­‰è°ƒåº¦ç®—æ³•',
                path: 'games/process-scheduling/index.html'
            },
            {
                id: 'memory-management',
                name: 'ä»“åº“ç²®é£Ÿç®¡ç†',
                subtitle: 'å†…å­˜ç®¡ç†',
                icon: 'ğŸ ',
                description: 'å­¦ä¹ åˆ†é¡µã€åˆ†æ®µã€è™šæ‹Ÿå†…å­˜ç­‰å†…å­˜ç®¡ç†æŠ€æœ¯',
                path: 'games/memory-management/index.html'
            },
            {
                id: 'file-system',
                name: 'æ‘åº„æ¡£æ¡ˆå®¤',
                subtitle: 'æ–‡ä»¶ç³»ç»Ÿ',
                icon: 'ğŸ“',
                description: 'å­¦ä¹ æ–‡ä»¶ã€ç›®å½•ã€inodeç­‰æ–‡ä»¶ç³»ç»Ÿæ¦‚å¿µ',
                path: 'games/file-system/index.html'
            },
            {
                id: 'process-sync',
                name: 'æ‘æ°‘åä½œ',
                subtitle: 'è¿›ç¨‹åŒæ­¥',
                icon: 'ğŸ¤',
                description: 'å­¦ä¹ ä¿¡å·é‡ã€äº’æ–¥é”ç­‰è¿›ç¨‹åŒæ­¥æœºåˆ¶',
                path: 'games/process-sync/index.html'
            },
            {
                id: 'deadlock-handling',
                name: 'èµ„æºäº‰ç«¯è°ƒè§£',
                subtitle: 'æ­»é”å¤„ç†',
                icon: 'âš–ï¸',
                description: 'å­¦ä¹ æ­»é”é¢„é˜²ã€æ£€æµ‹å’Œæ¢å¤',
                path: 'games/deadlock-handling/index.html'
            },
            {
                id: 'io-management',
                name: 'ç‰©èµ„è¿è¾“é˜Ÿ',
                subtitle: 'I/Oç®¡ç†',
                icon: 'ğŸšš',
                description: 'å­¦ä¹ ä¸­æ–­ã€ç¼“å†²ã€Spoolingç­‰I/OæŠ€æœ¯',
                path: 'games/io-management/index.html'
            }
        ];

        // Phaseræ¸¸æˆåœºæ™¯ - æ‘åº„å¹¿åœº
        class VillageScene extends Phaser.Scene {
            constructor() {
                super({ key: 'VillageScene' });
            }

            preload() {
                // è¿™é‡Œä¼šé¢„åŠ è½½æ¸¸æˆèµ„æº
                this.load.image('bg', 'data:image/svg+xml;base64,' + btoa(`
                    <svg xmlns="http://www.w3.org/2000/svg" width="1024" height="768">
                        <rect fill="#87CEEB" width="1024" height="768"/>
                        <rect fill="#90EE90" y="500" width="1024" height="268"/>
                    </svg>
                `));
            }

            create() {
                // éšè—åŠ è½½ç•Œé¢
                document.getElementById('loading-screen').style.display = 'none';

                const width = this.cameras.main.width;
                const height = this.cameras.main.height;

                // æ ‡é¢˜
                this.add.text(width / 2, 50, 'æ“ä½œç³»ç»Ÿæ™ºæ…§ä¹¡æ‘', {
                    fontSize: '48px',
                    fill: '#2c3e50',
                    fontStyle: 'bold',
                    fontFamily: 'Arial, sans-serif'
                }).setOrigin(0.5);

                this.add.text(width / 2, 100, 'é€‰æ‹©ä¸€ä¸ªå»ºç­‘ç‰©å¼€å§‹å­¦ä¹ ', {
                    fontSize: '24px',
                    fill: '#7f8c8d',
                    fontFamily: 'Arial, sans-serif'
                }).setOrigin(0.5);

                // å­—èŠ‚å”è§’è‰²
                const uncleContainer = this.add.container(width / 2, 180);

                const uncleBg = this.add.graphics();
                uncleBg.fillStyle(0xffffff, 0.9);
                uncleBg.fillRoundedRect(-200, -60, 400, 120, 10);

                const uncleText = this.add.text(0, -20, 'ğŸ‘´ å­—èŠ‚å”', {
                    fontSize: '32px',
                    fontFamily: 'Arial, sans-serif'
                }).setOrigin(0.5);

                const uncleDialog = this.add.text(0, 20, 'æ¬¢è¿æ¥åˆ°æ™ºæ…§ä¹¡æ‘ï¼ç‚¹å‡»å»ºç­‘ç‰©å¼€å§‹å­¦ä¹ æ“ä½œç³»ç»ŸçŸ¥è¯†å§', {
                    fontSize: '16px',
                    fill: '#34495e',
                    fontFamily: 'Arial, sans-serif',
                    align: 'center',
                    wordWrap: { width: 350 }
                }).setOrigin(0.5);

                uncleContainer.add([uncleBg, uncleText, uncleDialog]);
                this.tweens.add({
                    targets: uncleContainer,
                    y: 190,
                    duration: 1500,
                    yoyo: true,
                    repeat: -1,
                    ease: 'Sine.easeInOut'
                });

                // æ¸¸æˆå»ºç­‘å¡ç‰‡
                const cardWidth = 280;
                const cardHeight = 160;
                const padding = 20;
                const cols = 3;
                const startX = (width - (cols * cardWidth + (cols - 1) * padding)) / 2 + cardWidth / 2;
                const startY = 350;

                GAMES.forEach((game, index) => {
                    const row = Math.floor(index / cols);
                    const col = index % cols;

                    const x = startX + col * (cardWidth + padding);
                    const y = startY + row * (cardHeight + padding);

                    // å¡ç‰ŒèƒŒæ™¯
                    const card = this.add.graphics();
                    card.fillStyle(0xffffff, 1);
                    card.fillRoundedRect(-cardWidth / 2, -cardHeight / 2, cardWidth, cardHeight, 10);
                    card.lineStyle(2, 0x3498db);
                    card.strokeRoundedRect(-cardWidth / 2, -cardHeight / 2, cardWidth, cardHeight, 10);

                    // æ¸¸æˆå›¾æ ‡
                    const icon = this.add.text(0, -cardHeight / 2 + 40, game.icon, {
                        fontSize: '48px'
                    }).setOrigin(0.5);

                    // æ¸¸æˆåç§°
                    const title = this.add.text(0, 10, game.name, {
                        fontSize: '20px',
                        fontStyle: 'bold',
                        fill: '#2c3e50'
                    }).setOrigin(0.5);

                    // æ¸¸æˆæè¿°
                    const desc = this.add.text(0, 40, game.subtitle, {
                        fontSize: '14px',
                        fill: '#7f8c8d'
                    }).setOrigin(0.5);

                    // ç»„åˆå®¹å™¨
                    const container = this.add.container(x, y);
                    container.add([card, icon, title, desc]);

                    // äº¤äº’åŒºåŸŸ
                    const hitArea = this.add.zone(
                        -cardWidth / 2, -cardHeight / 2,
                        cardWidth, cardHeight
                    ).setInteractive({ useHandCursor: true });

                    container.add(hitArea);

                    // æ‚¬åœæ•ˆæœ
                    hitArea.on('pointerover', () => {
                        card.clear();
                        card.fillStyle(0xf0f8ff, 1);
                        card.fillRoundedRect(-cardWidth / 2, -cardHeight / 2, cardWidth, cardHeight, 10);
                        card.lineStyle(3, 0xe74c3c);
                        card.strokeRoundedRect(-cardWidth / 2, -cardHeight / 2, cardWidth, cardHeight, 10);
                    });

                    hitArea.on('pointerout', () => {
                        card.clear();
                        card.fillStyle(0xffffff, 1);
                        card.fillRoundedRect(-cardWidth / 2, -cardHeight / 2, cardWidth, cardHeight, 10);
                        card.lineStyle(2, 0x3498db);
                        card.strokeRoundedRect(-cardWidth / 2, -cardHeight / 2, cardWidth, cardHeight, 10);
                    });

                    // ç‚¹å‡»äº‹ä»¶
                    hitArea.on('pointerdown', () => {
                        this.launchGame(game);
                    });
                });

                // æŠ¥å‘ŠæŒ‰é’®
                const reportBtn = this.add.graphics();
                reportBtn.fillStyle(0xf39c12, 1);
                reportBtn.fillRoundedRect(0, 0, 200, 50, 10);

                const reportText = this.add.text(100, 25, 'ğŸ“Š å­¦ä¹ æŠ¥å‘Š', {
                    fontSize: '18px',
                    fontStyle: 'bold',
                    fill: '#ffffff'
                }).setOrigin(0.5);

                const reportContainer = this.add.container(width - 120, height - 40);
                reportContainer.add([reportBtn, reportText]);

                reportContainer.setSize(200, 50);
                reportContainer.setInteractive({ useHandCursor: true });
                reportContainer.on('pointerdown', () => {
                    this.showReport();
                });
            }

            launchGame(game) {
                // è·³è½¬åˆ°æ¸¸æˆé¡µé¢
                window.location.href = game.path;
            }

            showReport() {
                alert('å­¦ä¹ æŠ¥å‘ŠåŠŸèƒ½å¼€å‘ä¸­...\nå°†åŒ…å«ï¼š\n- å­¦ä¹ è¿›åº¦ç»Ÿè®¡\n- æ¸¸æˆæˆç»©åˆ†æ\n- AIå­¦ä¹ å»ºè®®');
            }
        }

        // Phaseré…ç½®
        const config = {
            type: Phaser.AUTO,
            width: 1024,
            height: 768,
            parent: 'game-container',
            backgroundColor: '#87CEEB',
            scene: VillageScene
        };

        // å¯åŠ¨æ¸¸æˆ
        const game = new Phaser.Game(config);

        // æš´éœ²åˆ°å…¨å±€
        window.OS_VILLAGE = {
            GAMES,
            api
        };
    </script>
</body>
</html>
